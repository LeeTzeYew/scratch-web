# Scratch编辑器操作记录器 — 详细使用指南

本文档详细说明如何安装、配置和使用Scratch编辑器操作记录器浏览器扩展，以及如何将记录的数据集成到主应用程序中。

## 目录

1. [安装前准备](#安装前准备)
2. [安装步骤](#安装步骤)
3. [基本使用方法](#基本使用方法)
4. [高级功能](#高级功能)
5. [与主应用集成](#与主应用集成)
6. [故障排除](#故障排除)
7. [常见问题](#常见问题)

## 安装前准备

在安装扩展前，请确保您拥有：

- Chrome浏览器（建议版本 90+）或Firefox浏览器（建议版本 88+）
- Windows、macOS或Linux操作系统
- 稳定的网络连接，以访问Scratch编辑器页面

## 安装步骤

### Chrome浏览器安装

1. 下载本扩展的代码包并解压到本地文件夹
2. 打开Chrome浏览器，在地址栏输入 `chrome://extensions/` 并访问
3. 在右上角找到并开启"开发者模式"开关
4. 点击页面左上角的"加载已解压的扩展"按钮
5. 在弹出的文件选择器中，选择解压后的扩展文件夹 `browser-extension`
6. 成功安装后，浏览器右上角工具栏会出现扩展图标

### Firefox浏览器安装

1. 下载本扩展的代码包并解压到本地文件夹
2. 打开Firefox浏览器，在地址栏输入 `about:debugging#/runtime/this-firefox` 并访问
3. 点击"临时载入附加组件"按钮
4. 在弹出的文件选择器中，选择解压后的扩展文件夹中的 `manifest.json` 文件
5. 成功安装后，浏览器工具栏会出现扩展图标

## 基本使用方法

### 开始录制操作

1. 访问Scratch编辑器页面：https://leetzeyew.github.io/scratch-editor
2. 点击浏览器工具栏中的扩展图标，打开控制面板
3. 在控制面板中点击"开始录制"按钮
4. 此时状态指示灯会变为红色并闪烁，表示正在录制中
5. 计时器开始计时，显示当前录制时长

### 在Scratch编辑器中操作

录制开始后，您可以在Scratch编辑器中进行各种操作，扩展会自动记录以下行为：

- 拖动积木（记录起始和结束位置）
- 点击积木或UI元素
- 运行或停止程序
- 编辑积木参数
- 选择不同分类的积木
- 添加新积木
- 复制、粘贴、删除积木
- 使用键盘快捷键

### 停止录制

1. 完成所需操作后，点击扩展控制面板中的"停止录制"按钮
2. 录制状态指示灯会变回灰色，计时器停止
3. 操作记录会自动保存在浏览器的本地存储中
4. 控制面板会显示已记录的操作数量

### 导出录制数据

1. 在控制面板中点击"导出最近录制"按钮
2. 浏览器会自动下载一个JSON格式的文件，包含所有记录的操作
3. 文件名格式为：`scratch-recording-[时间戳].json`

## 高级功能

### 自定义设置

在扩展控制面板的"设置"部分，您可以配置以下选项：

- **打开编辑器时自动开始录制**：勾选此选项后，每次打开Scratch编辑器页面时会自动开始录制
- **保存录制数据到文件**：勾选此选项后，停止录制时会自动导出数据文件
- **与主应用同步数据**：勾选此选项后，录制数据会自动发送到主应用程序

### 通过扩展图标快速控制

除了通过控制面板操作外，您还可以直接点击扩展图标来控制录制：

1. 在Scratch编辑器页面中，直接点击扩展图标可切换录制状态
2. 录制中时，扩展图标会变为红色
3. 非录制状态时，扩展图标为默认颜色

### 清除录制数据

如果需要清除所有已保存的录制数据：

1. 在控制面板中点击"清除数据"按钮
2. 在弹出的确认对话框中点击"确定"
3. 所有本地存储的录制数据将被删除

## 与主应用集成

要将录制器与主应用程序集成，需要在主应用中添加接收器脚本，步骤如下：

### 添加接收器脚本

1. 将 `main-app-receiver.js` 文件添加到您的主应用程序中
2. 在HTML页面中通过 `<script>` 标签引入此脚本，或在React应用中导入
3. 脚本会自动初始化并监听来自扩展的消息

### 处理录制数据

接收器脚本提供了两种方式处理录制数据：

#### 方法一：通过全局事件

```javascript
// 在您的应用代码中监听事件
window.addEventListener('scratch-operations-received', (event) => {
  const recordData = event.detail;
  // 处理录制数据
  console.log('收到操作记录:', recordData.operations);
});
```

#### 方法二：通过全局函数

```javascript
// 在您的应用中定义处理函数
window.handleScratchOperations = function(data) {
  // 处理录制数据
  console.log('收到操作记录:', data.operations);
  // 将数据保存到应用状态
  saveOperationsToState(data.operations);
};
```

### 手动获取录制数据

您也可以通过接收器提供的API手动获取最后一次录制的数据：

```javascript
// 获取最近一次录制的数据
const recordData = window.scratchOperationReceiver.getLastReceivedData();
if (recordData) {
  console.log('操作记录:', recordData.operations);
}

// 手动导出数据到文件
window.scratchOperationReceiver.exportDataToFile();
```

## 故障排除

### 扩展无法正常工作

如果扩展未能正常工作，请尝试以下步骤：

1. 检查浏览器版本是否满足要求
2. 在扩展管理页面中禁用并重新启用扩展
3. 清除浏览器缓存后重试
4. 重新安装扩展

### 无法记录操作

如果扩展无法记录操作，请检查：

1. 确认访问的是正确的Scratch编辑器URL（https://leetzeyew.github.io/scratch-editor）
2. 打开浏览器控制台（F12），查看是否有错误信息
3. 确认录制状态指示灯是否为红色并闪烁

### 数据未被主应用接收

如果录制数据未能被主应用接收，请检查：

1. 确认主应用页面已正确加载接收器脚本
2. 检查浏览器控制台中是否有通信相关的错误
3. 确认扩展设置中"与主应用同步数据"选项已勾选

## 常见问题

### Q: 录制的数据会保存多久？
A: 数据保存在浏览器的本地存储中，除非手动清除或浏览器清除缓存，否则会一直保存。

### Q: 我能同时录制多个窗口中的Scratch编辑器操作吗？
A: 可以，扩展会分别记录每个窗口中的操作，但导出时只包含最后一次停止录制的窗口数据。

### Q: 扩展能记录哪些Scratch编辑器操作？
A: 扩展可以记录几乎所有用户交互，包括积木拖放、点击、运行代码、编辑参数等。详细记录内容请参考数据文件中的操作类型。

### Q: 录制数据的格式是什么？
A: 录制数据以JSON格式保存，包含操作类型、时间戳和相关参数。数据结构示例：

```json
{
  "operations": [
    {
      "type": "blockMove",
      "blockId": "block-123",
      "startPosition": {"x": 100, "y": 200},
      "endPosition": {"x": 150, "y": 250},
      "timestamp": 5
    },
    {
      "type": "executeCode",
      "action": "运行程序",
      "timestamp": 10
    }
  ],
  "recordedAt": "2023-07-20T08:30:25.000Z",
  "duration": 15
}
``` 